import{d as w,v as C,j as B,i as L,k as $,r as q,o as A,n as N,w as h,p as S,e as a,b as V,a as r,f as t,c as u,x as d,y as E,F,q as P}from"./index.js";import{_ as T}from"./CenteredContainer.js";const U={href:"#",class:"flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white"},j=["src"],D={key:0,class:"text-xl font-bold text-white mt-4"},I={key:1,class:"text-xl font-bold text-red-400 mt-4"},M=r("h1",{class:"text-xl font-bold text-white my-4"}," Connessione effettuata. ",-1),O={class:"text-white text-xs text-grey-300"},H=w({__name:"callback",setup(R){const{getLogoUrl:g}=P(),m=C(),_=B("erp"),p=L(),e=$("inext__isLogging","pending"),s=q(10),x=()=>{setInterval(()=>{s.value=s.value-1,s.value==0&&window.close()},1e3)};return A(()=>{const{code:c}=m.query;c&&_.get("https://erp.dssia.it/api/v1/callback",{params:{code:c,redirect_uri:"/auth/callback"}}).then(({data:o})=>{const{errors:n,data:l}=o;if(n.length==0){const{auth_response:{access_token:k}}=l;_.get("connectuser",{params:{access_token:k,redirect_uri:"/auth/callback"}}).then(({data:i})=>{const{errors:f,data:b}=i;if(f.length==0){const{token:v,user:y}=b;p.setToken(v),p.setUser(y),e.value="done",x()}else console.log("errors connect",f),e.value="failed"},i=>{console.log("then errors connect",i),e.value="failed"})}else console.log("errors callback",n),e.value="failed"},o=>{console.log("then error callback",o),e.value="failed"})}),(c,o)=>{const n=T,l=S;return a(),N(l,null,{default:h(()=>[V(n,null,{default:h(()=>[r("a",U,[r("img",{class:"h-8 mr-2",src:t(g)(),alt:"logo",title:"Logo"},null,8,j)]),t(e)=="pending"?(a(),u("h1",D,"Connessione in corso ...")):d("",!0),t(e)=="failed"?(a(),u("h1",I,"Ops, c'è stato un errore")):d("",!0),t(e)=="done"?(a(),u(F,{key:2},[M,r("p",O,"questa finestra si chiuderà tra "+E(t(s))+" secondi",1)],64)):d("",!0)]),_:1})]),_:1})}}});export{H as default};
