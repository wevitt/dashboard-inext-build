import{d as y,A as C,j as B,i as A,k as L,l as $,o as q,q as N,w as h,s as S,e as a,b as V,a as r,f as t,c as u,B as d,D,F as E,x as F}from"./index.js";import{_ as P}from"./CenteredContainer.js";const T={href:"#",class:"flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white"},U=["src"],j={key:0,class:"text-xl font-bold text-white mt-4"},I={key:1,class:"text-xl font-bold text-red-400 mt-4"},M=r("h1",{class:"text-xl font-bold text-white my-4"}," Connessione effettuata. ",-1),O={class:"text-white text-xs text-grey-300"},H=y({__name:"callback",setup(R){const{getLogoUrl:g}=F(),m=C(),_=B("erp"),p=A(),e=L("inext__isLogging","pending"),s=$(10),x=()=>{setInterval(()=>{s.value=s.value-1,s.value==0&&window.close()},1e3)};return q(()=>{const{code:c}=m.query;c&&_.get("https://erp.dssia.it/api/v1/callback",{params:{code:c,redirect_uri:"/auth/callback"}}).then(({data:o})=>{const{errors:n,data:l}=o;if(n.length==0){const{auth_response:{access_token:k}}=l;_.get("connectuser",{params:{access_token:k,redirect_uri:"/auth/callback"}}).then(({data:i})=>{const{errors:f,data:b}=i;if(f.length==0){const{token:v,user:w}=b;p.setToken(v),p.setUser(w),e.value="done",x()}else console.log("errors connect",f),e.value="failed"},i=>{console.log("then errors connect",i),e.value="failed"})}else console.log("errors callback",n),e.value="failed"},o=>{console.log("then error callback",o),e.value="failed"})}),(c,o)=>{const n=P,l=S;return a(),N(l,null,{default:h(()=>[V(n,null,{default:h(()=>[r("a",T,[r("img",{class:"h-8 mr-2",src:t(g)(),alt:"logo",title:"Logo"},null,8,U)]),t(e)=="pending"?(a(),u("h1",j,"Connessione in corso ...")):d("",!0),t(e)=="failed"?(a(),u("h1",I,"Ops, c'è stato un errore")):d("",!0),t(e)=="done"?(a(),u(E,{key:2},[M,r("p",O,"questa finestra si chiuderà tra "+D(t(s))+" secondi",1)],64)):d("",!0)]),_:1})]),_:1})}}});export{H as default};
